"use strict";!function(){let index=0;function addEvent(){var searchInput=$('#fsBar'),searchList=$('.global-search-list'),searchListContainer=$('.global-search .global-search-select-dropdown'),cpLock=false;searchInput.attr('placeholder',lang_string('搜索'));searchInput.on('input propertychange',function(){if(!cpLock)searchCoin(this);const searchText=filterXSS($('#fsBar').val(),1);if(searchText.length>1){$('.global-search-placeholder-view').hide()}else{$('.global-search-select-dropdown').hide();$('.global-search-placeholder-view').show()}index=0}).on('compositionstart',function(){cpLock=true}).on('compositionend',function(){cpLock=false;if(!cpLock)searchCoin(this);index=0}).on('focus',function(){const searchText=filterXSS($('#fsBar').val(),1);if(searchText.length>0){$('.global-search-placeholder-view').hide()}else{$('.global-search-placeholder-view').show()}});PubSub.subscribe('DRAW_GLOBAL_SEARCH_PLACEHOLDER',drawSearchPlaceHolder);function drawSearchPlaceHolder(key,res){if(res){$('#globalSearchArea .search-placeholder-container').html('');let globalSearchHistory=JSON.parse(localStorage.getItem('globalSearchHistory')||'[]');let placeHolderHtml=`
          ${globalSearchHistory.length!==0?`<div class='search-list-title search-history-title'><span>${searchHistoryLanguage}</span><span class='clear-search-history'>${lang_string('清除')}</span></div>`:''}
          <div class='search-history-container'>${globalSearchHistory.map((history,index1)=>{if(index1<10){return`<span class='search-history-item' data-history='${history}'>${history}</span>`}return''}).join('')}</div>
          <div class='search-list-title'>${hotSearchRankLanguage}<span class='search-hot-rank'><span style='transform: scale(0.83)'>HOT</span></span></div>
          <div class='hot-list-container'>${res.map(hot=>{return`
            <div class='hot-rank-item' data-pair='${hot.coin.toUpperCase()}'>
              <span class='global-search-coin-icon' style='background-image: url("/images/coin_icon/64/${hot.coin.toLowerCase()}.png")'></span>
              <span class='hot-rank-item-name'>${hot.coin}</span>
              <span class='hot-rank-item-rate ${Number(hot.change)>0?'red':'green'}'>${(Number(hot.change)>0?'+':'')+hot.change}%</span>
                 <span class='global-search-market-ranking'>
              <span>#${hot.marketcap_rank}</span>
              <div class='global-search-market-ranking-hit'>${lang_string('市值排名')} #${hot.marketcap_rank}</div>
            </span>
          </div>
          `}).join('')}</div>
          <div class='search-more-container'><span class='search-more'>${lang_string('More')}  <svg style="margin-left: 3px;" width="7" height="10" viewBox="0 0 7 10" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1.00001 1L5 5L1 9" stroke="#04091A" stroke-width="2"/></svg></span></div>
      `;$('#globalSearchArea .search-placeholder-container').html(placeHolderHtml);$('#globalSearchArea .clear-search-history').on('click',function(e){localStorage.setItem('globalSearchHistory','[]');$('#globalSearchArea .search-history-container').html('');$('#globalSearchArea .search-history-title').hide()});$('#globalSearchArea .search-more').on('click',function(e){var href='/trade/';location.href=href});$('#globalSearchArea .hot-rank-item').on('click',function(e){const pair=$(this).attr('data-pair');let globalSearchHistory1=JSON.parse(localStorage.getItem('globalSearchHistory')||'[]');if(globalSearchHistory1.indexOf(pair)=== -1){globalSearchHistory1.unshift(pair);localStorage.setItem('globalSearchHistory',JSON.stringify(globalSearchHistory1))}var href=`/trade/${pair}_USDT`;location.href=href});$('#globalSearchArea .search-history-item').on('click',function(e){const history=$(this).attr('data-history');const searchText=filterXSS(history,1);$('#fsBar').val(searchText);$('#fsBar').trigger('propertychange')})}}$('.showSoftKeyBoard').on('click',function(){searchInput.focus();$('.softKeyBoard').is(':visible')?$('.softKeyBoard').hide():$('.softKeyBoard').show()});$(document).on('mousedown',function(e){var _con=$('#globalSearchArea');if(!_con.is(e.target)&&_con.has(e.target).length===0){$('.softKeyBoard').hide()}});var _html='',keys=['1','2','3','4','5','6','7','8','9','0','Q','W','E','R','T','Y','U','I','O','P','A','S','D','F','G','H','J','K','L','off','Z','X','C','V','B','N','M','backspace',];keys.forEach(_key=>{if(_key==='backspace'){_html+='<div data-val='+_key+' class=\'keyboardBS\'>'+'   <i class=\'caretIcon\' data-val='+_key+'></i>'+'   <i class=\'closeIcon\' data-val='+_key+'></i>'+'</div>'}else if(_key==='off'){_html+='<div data-val='+_key+' class=\'keyboardBS off\'>'+'   <i class=\'closeIcon\' data-val='+_key+'></i>'+'</div>'}else{_html+='<button  data-val='+_key+'>'+_key+'</button>'}});var keybb=$('#keybb'),fsBar=searchInput;keybb.html(_html);keybb.on('click','button',function(){let _val=$(this).attr('data-val'),iptVal=fsBar.val();fsBar.val(iptVal+_val).focus();searchCoin(fsBar[0]);index=0}).on('click','div[data-val=\'backspace\']',function(){let iptVal=fsBar.val();if(fsBar[0].selectionStart!==fsBar[0].selectionEnd){fsBar.val(iptVal.replace(iptVal.substring(fsBar[0].selectionStart,fsBar[0].selectionEnd),'')).focus()}else{fsBar.val(iptVal.substring(0,iptVal.length-1)).focus()}searchCoin(fsBar[0]);index=0}).on('click','.off',function(){$('.softKeyBoard').hide();fsBar.blur()});searchList.on('click','p',function(){if($(this).hasClass('no-search-data'))return;var href=$(this).attr('data-href');var type=$(this).attr('data-type');let globalSearchHistory=JSON.parse(localStorage.getItem('globalSearchHistory')||'[]');const searchText=filterXSS($('#fsBar').val(),1);if(globalSearchHistory.indexOf(searchText)=== -1){globalSearchHistory.unshift(searchText);localStorage.setItem('globalSearchHistory',JSON.stringify(globalSearchHistory))}if(href){location.href=href}});$(document).on('mousedown',function(e){var _con=$('#globalSearchArea');if(!_con.is(e.target)&&_con.has(e.target).length===0){searchList.html('');$('.global-search .global-search-select-dropdown').hide();$('.global-search .global-search-placeholder-view').hide();searchInput.val('')}})}function searchCoin(_this,e){$(_this).val(filterXSS($(_this).val(),1));var needle=filterXSS(_this.value.toUpperCase(),1);if(needle.length<2){$('.global-search .global-search-select-dropdown').hide();$('.global-search .global-search-placeholder-view').show();return false}if(!window.global_search_data||window.global_search_data==={}){renderNoData();return false}let searchList={};let isEmpty=true;Object.keys(window.global_search_data).forEach(key=>{var pairs=window.global_search_data[key];var arr1=[];var arr2=[];var arr3=[];pairs.map(value=>{var c_a=value.name.split('_')[0].toUpperCase();if(c_a===needle){arr1.push(value)}else if(c_a.indexOf(needle)> -1){arr2.push(value)}});if(key==='spot'||key==='etf'||key==='contract'){const result=[...arr1,...arr2,...arr3];if(result.length!==0){searchList[key]=result;isEmpty=false}}else{const result=[...arr1,...arr2,...arr3];if(result.length!==0){if(!searchList['finance']){searchList['finance']={}}searchList['finance'][key]=result;isEmpty=false}}});if(needle){isEmpty?renderNoData():renderList(searchList,needle)}else{$('.global-search-list').html('');$('.global-search .global-search-select-dropdown').hide()}searchList=null}function renderList(arr,needle){var str='';var customData=localStorage.getItem('custom')||'';var custom_arr=customData.toLowerCase().split(',');let favorsContracts=localStorage.getItem('favor-contracts')||'[]';let favorsContractsArr=JSON.parse(favorsContracts.toLowerCase());const translateTitle={spot:spotLanguage,etf:'ETF',contract:contractLanguage,finance:financeLanguage,borrow:marginTenderLanguage,lend:marginFinancialLanguage,liquidity:yieldFarmingLanguage,mortgage:cryptoLoanLanguage};Object.keys(arr).forEach((key,arrIndex)=>{const list=arr[key];str+=`<div class='search-list-title'>${lang_string(translateTitle[key])}</div>`;if(key!=='finance'){str+=`<div class='search-list-item-container'>
      ${list.map(value=>{return`<p data-href='${value.href}' data-type='${value.type}' data-pair='${value.name.toUpperCase()}'>
              ${markSearchNeedle(value.name,needle)}
              ${value.type!='contract'?`<span class='fav_icon pull-right search_fav ${custom_arr.indexOf(value.name.toLowerCase())> -1?'custom-on':''}' data-type='${value.type}' data-id='${value.name.toLowerCase()}' title='${lang_string(custom_arr.indexOf(value.name.toLowerCase())> -1?'取消自选':'加自选')}'></span>`:``}
              ${value.type==='contract'?`<span class='fav_icon pull-right search_fav ${favorsContractsArr.indexOf(value.name.toLowerCase())> -1?'custom-on':''}' data-type='${value.type}' data-id='${value.name.toLowerCase()}' title='${lang_string(custom_arr.indexOf(value.name.toLowerCase())> -1?'取消自选':'加自选')}'></span>`:``}
            </p>`}).join('')}
        </div>`}else{str+=`<div class='search-finance-container'>${Object.keys(list).map(financeItemKey=>{const financeItemList=list[financeItemKey];return`
            <div class='search-finance-list-container'>
              <div class='search-list-second-title'>${lang_string(translateTitle[financeItemKey])}</div>
              ${financeItemList.map(cell=>{return`<p class='' data-href='${cell.href}' data-type='${cell.type}' data-pair='${cell.name.toUpperCase()}'>
                        ${markSearchNeedle(cell.name,needle)}
                      </p>`}).join('')}
            </div>
          `}).join('')}</div>`}});$('.global-search-list').html(str);$('.global-search .global-search-select-dropdown').show()}function markSearchNeedle(str,needle){var strArray=str.toUpperCase().split('_');if(strArray.length>1){strArray=[strArray[0],'_',strArray[1]]}const newStr=`${strArray[0].replace(new RegExp(needle.toUpperCase()),`<span class='search_needle'>${needle.toUpperCase()}</span>`)}`;strArray[0]=newStr;return`<span>${strArray.join("")}</span>`}function renderNoData(){$('.global-search-list').html('<div class="noorder"></div><div class="no-search-data">'+lang_string('暂无数据')+'</div>');$('.global-search .global-search-select-dropdown').show()}function stopDefault(e){if(e&&e.preventDefault){e.preventDefault()}else{event.returnValue=false}}function addCoinCookie(_this){var coinType=_this.attr('data-type');var coinID=_this.attr('data-id');if(coinType==='contract'){let favorsContracts=JSON.parse(localStorage.getItem('favor-contracts'))||[];favorsContracts=[coinID].concat(favorsContracts);localStorage.setItem('favor-contracts',JSON.stringify(favorsContracts));PubSub.publish('CHANGE_CONTRACT_FAV_COIN',{action:'add',pair:coinID})}else{var currCo=localStorage.getItem('custom');if(currCo){var currCookie=localStorage.getItem('custom').split(',');if($.inArray(coinID,currCookie)=== -1){var newCookieVal=[...currCookie,coinID];localStorage.setItem('custom',newCookieVal)}}else{localStorage.setItem('custom',coinID)}PubSub.publish('CHANGE_SPOT_FAV_COIN',{action:'add',pair:coinID})}}function cutCoinCookie(_this){var coinType=_this.attr('data-type');var coinID=_this.attr('data-id');if(coinType==='contract'){let favorsContracts=JSON.parse(localStorage.getItem('favor-contracts'))||[];if(favorsContracts){favorsContracts=favorsContracts.filter(c=>c!==coinID)}localStorage.setItem('favor-contracts',JSON.stringify(favorsContracts));PubSub.publish('CHANGE_CONTRACT_FAV_COIN',{action:'reduce',pair:coinID})}else{var coinCookie=localStorage.getItem('custom');if(coinCookie){var coinCookieArr=coinCookie.split(',');function removeByValue(arr,val){for(var i=0;i<arr.length;i++){if(arr[i]===val){arr.splice(i,1);break}}}removeByValue(coinCookieArr,coinID);if(coinCookieArr.length===0){localStorage.removeItem('custom')}else{localStorage.setItem('custom',coinCookieArr)}}PubSub.publish('CHANGE_SPOT_FAV_COIN',{action:'reduce',pair:coinID})}}let favObj={};let favTimeOut;$('.global-search-list').on('click','.fav_icon',function(e){e=window.event||e;e.stopPropagation();var _this=$(this);var pair=_this.attr('data-id');var list_tbody=$('#list_tbody');if(_this.hasClass('custom-on')){_this.removeClass('custom-on').attr('title',lang_string('加自选'));cutCoinCookie(_this)}else{_this.addClass('custom-on').attr('title',lang_string('取消自选'));addCoinCookie(_this)}customCookie=localStorage.getItem('custom');if(favObj[_this.attr('data-id')]!==undefined){delete favObj[_this.attr('data-id')]}else{if(_this.hasClass('custom-on')){favObj[_this.attr('data-id')]=1}else{favObj[_this.attr('data-id')]=0}}var coinType=_this.attr('data-type');if(coinType!=='contract'){if(!favTimeOut){favTimeOut=setTimeout(()=>{$.ajax({type:'post',url:'json_svr/query?u=29&c=336750',data:{type:'set_customer_pairs',pairs:JSON.stringify(favObj)},success:function(data){if(data.resMsg.code===0){favTimeOut=undefined;favObj={}}}})},3e3)}}return false});$(function(){addEvent()})}()